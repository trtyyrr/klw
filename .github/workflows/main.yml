name: ğŸš¢ çº¯å‘å¸ƒæµç¨‹ (å…¨é‡æ‰“åŒ…)

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch: # åŒæ—¶ä¹Ÿæ”¯æŒæ‰‹åŠ¨è§¦å‘
jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: 1. æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: 2. æ£€æŸ¥ç›®å½•å¹¶æ‰“åŒ…
        id: pack
        run: |
          # ç¡®ä¿è¿›å…¥ä»“åº“æ ¹ç›®å½•
          SUB_DIR="MyKSUModule"
          
          # è°ƒè¯•ä¿¡æ¯ï¼šåœ¨æ—¥å¿—é‡Œåˆ—å‡ºæ–‡ä»¶ï¼Œç¡®ä¿æˆ‘ä»¬æ²¡æ‰¾é”™åœ°æ–¹
          echo "æ­£åœ¨æ£€æŸ¥ $SUB_DIR ç›®å½•å†…å®¹ï¼š"
          ls -R $SUB_DIR

          # ä¿®å¤æ¢ç¬¦ï¼ˆé˜²æ­¢åˆ·å…¥æ‰‹æœºæŠ¥é”™ï¼‰
          find "$SUB_DIR" -type f -name "*.sh" -exec sed -i 's/\r$//' {} +
          
          # èµ‹äºˆæ‰§è¡Œæƒé™
          chmod -R +x "$SUB_DIR"/*.sh
          [ -f "$SUB_DIR/thread_manager" ] && chmod +x "$SUB_DIR/thread_manager"

          # å‹ç¼©æ‰“åŒ…é€»è¾‘
          # æˆ‘ä»¬å…ˆè¿›å…¥ç›®å½•ï¼Œç¡®ä¿ Zip æ ¹ç›®å½•å°±æ˜¯æ¨¡å—æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å¸¦ä¸ª MyKSUModule å£³
          cd "$SUB_DIR"
          ZIP_NAME="../UltraPowerSaver_${{ github.ref_name }}.zip"
          
          # ç›´æ¥å…¨é‡æ‰“åŒ…æ‰€æœ‰æ–‡ä»¶ (åŒ…æ‹¬ src)
          zip -r "$ZIP_NAME" ./* -x ".git*"
          
          echo "zip_path=UltraPowerSaver_${{ github.ref_name }}.zip" >> $GITHUB_OUTPUT

      - name: 3. ä¸Šä¼ åˆ° Release
        uses: softprops/action-gh-release@v2
        with:
          files: ${{ steps.pack.outputs.zip_path }}
          tag_name: ${{ github.ref_name }}
          name: "æ­£å¼ç‰ˆ ${{ github.ref_name }}"
          body: "æ¨¡å—å·²å…¨é‡æ‰“åŒ…ï¼ŒåŒ…å«æ‰€æœ‰æ ‡å‡†ç›®å½•ã€‚"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}